357a3a8f8a1609cb35f6cbc8f3a2923d2f443e2bba836e97cc42da91fea5e3ab:{"__metadata":{"version":0.1},"root":{"steps":[{"step_id":"d071bc10-8a65-11f0-88f8-0b6c3725d20a","step_position":[0,0],"config_field_values":[],"task_id":"fa0550f6-ef7d-4210-b6d8-6c42169e5f86","task_version":"1.0","task_type":"TRIGGER","description":null,"note":null,"name":null},{"step_id":"35620940-8a66-11f0-88f8-0b6c3725d20a","step_position":[360,0],"config_field_values":[{"config_field_id":"type","value":"creator"},{"config_field_id":"handle","value":"{{ccCreatorShopHandle}}"}],"task_id":"shopify::flow::fetch::metaobject","task_version":"v1","task_type":"ACTION","description":"Get all your CreatorCommerce data.","note":null,"name":"Get metaobject entry"},{"step_id":"49881e00-8a66-11f0-88f8-0b6c3725d20a","step_position":[720,0],"config_field_values":[{"config_field_id":"input","value":"query{\n  getMetaobjectEntry{\n    data\n  }\n}"},{"config_field_id":"script","value":"export default function main(input) {\n  const parsed = JSON.parse(input.getMetaobjectEntry.data);\n\n  // Ensure the array exists\n  const drops = parsed[\"cc-creator-drops\"] || [];\n  if (drops.length === 0) {\n    return { updatedThisHour: false, dropData: \"[]\" };\n  }\n\n  // Current timestamp truncated to the hour\n  const now = new Date();\n  const currentHour = now.toISOString().slice(0, 13); // \"YYYY-MM-DDTHH\"\n\n  // Find the drop updated this hour\n  const updatedDrop = drops.find(drop => {\n    const updated = new Date(drop.updated_at || drop.created_at || 0);\n    return updated.toISOString().slice(0, 13) === currentHour;\n  });\n\n  return {\n    updatedThisHour: !!updatedDrop,\n    dropData: JSON.stringify(updatedDrop ? [updatedDrop] : [])\n  };\n}"},{"config_field_id":"output_schema","value":"\"\"\"\nThe output of Run Code\n\"\"\"\ntype Output {\n  \"\"\"\n  The message returned by the script\n  \"\"\"\n  dropData: String!\n  \n  \"\"\"\n  True if a drop was updated this hour\n  \"\"\"\n  updatedThisHour: Boolean!\n}"}],"task_id":"shopify::flow::run_code","task_version":"0.1","task_type":"ACTION","description":"Checks is a drop was updated in the last hour. If so, it's going to proceed and run a prompt against the drop data and update the drop features.","note":null,"name":"Run code"},{"step_id":"b76130f0-8a67-11f0-88f8-0b6c3725d20a","step_position":[1500,-20],"config_field_values":[{"config_field_id":"prompt","value":"You are given a JSON object containing one or more creator drops.\nEach drop contains an array of products with titles, descriptions, and details.\n\nYour task:\n\t• For each drop (cc-creator-drop-collection-id), analyze all products inside it.\n\t• Distill their main benefits into exactly 4 short features (≤20 characters each).\n\t• Summarize at the drop level (not per product).\n\t• Use plain, benefit-driven phrases (e.g., \"Skin Calming Relief\", \"Supports Gut Health\", \"Protein Recovery Boost\"), but write them yourself based on the summary of products given to you (DO NOT USE MY EXAMPLE unless they actually apply)\n\t• Avoid repeating the same benefit across all drops unless it truly applies.\n\nStrict output rules:\n\t• Return only valid JSON, this will be used in a programatic flow so do not include text like output or json\n\t• Do not include extra text, explanations, headers, or labels (like JSON, OUTPUT, or backticks).\n\t• The returned JSON must match exactly this schema:\nFORMAT\n{\n  \"<drop-id>\": {\n    \"cc-creator-drop-collection-id\": \"<drop-id>\",\n    \"items\": [\n      \"string-1\",\n      \"string-2\",\n      \"string-3\",\n      \"string-4\"\n    ]\n  }\n}\n\nINPUT CONTEXT\n\n{{runCode.dropData}}\n"},{"config_field_id":"model","value":"gpt-4o-mini"},{"config_field_id":"suffix","value":""},{"config_field_id":"max_tokens","value":"256"},{"config_field_id":"temperature","value":"0.7"},{"config_field_id":"top_p","value":"1"},{"config_field_id":"stop","value":""},{"config_field_id":"presence_penalty","value":"0"},{"config_field_id":"frequency_penalty","value":"0"},{"config_field_id":"logit_bias","value":""}],"task_id":"b673868d-0ee5-431e-9449-7584e81269c0","task_version":"0.1","task_type":"ACTION","description":"Summarizes the drop data with AI.","note":null,"name":"Generate text"},{"step_id":"4d952fe0-8a68-11f0-88f8-0b6c3725d20a","step_position":[1120,0],"config_field_values":[{"config_field_id":"condition","value":"{\"uuid\":\"50ac5af2-8a68-11f0-88f8-0b6c3725d20a\",\"lhs\":{\"uuid\":\"4f08e420-8a68-11f0-88f8-0b6c3725d20a\",\"parent_uuid\":\"50ac5af2-8a68-11f0-88f8-0b6c3725d20a\",\"lhs\":{\"uuid\":\"50ac5af0-8a68-11f0-88f8-0b6c3725d20a\",\"parent_uuid\":\"4f08e420-8a68-11f0-88f8-0b6c3725d20a\",\"value\":\"runCode.updatedThisHour\",\"comparison_value_type\":\"EnvironmentValue\",\"full_environment_path\":\"runCode.updatedThisHour\"},\"rhs\":{\"uuid\":\"510aa790-8a68-11f0-88f8-0b6c3725d20a\",\"parent_uuid\":\"4f08e420-8a68-11f0-88f8-0b6c3725d20a\",\"value\":\"true\",\"comparison_value_type\":\"LiteralValue\"},\"value_type\":\"EnvironmentScalarDefinition:Boolean\",\"operator\":\"==\",\"operation_type\":\"Comparison\"},\"operator\":\"AND\",\"operation_type\":\"LogicalExpression\"}"}],"task_id":"shopify::flow::condition","task_version":"0.1","task_type":"CONDITION","description":"Checks if there is a recent drop.","note":null,"name":null},{"step_id":"661e9ec0-8a68-11f0-88f8-0b6c3725d20a","step_position":[2240,-20],"config_field_values":[{"config_field_id":"api_call","value":"{\"name\":\"metaobjectUpdate\",\"blob\":\"{\\n  \\\"id\\\": \\\"{{getMetaobjectEntry.system.id}}\\\",\\n  \\\"metaobject\\\": {\\n    \\\"handle\\\": \\\"creator\\\",\\n    \\\"fields\\\": [\\n      {\\n        \\\"key\\\": \\\"cc_bundle_summaries\\\",\\n        \\\"value\\\": {{runCode1.text}}\\n      }\\n    ],\\n    \\\"capabilities\\\": {\\n      \\\"publishable\\\": {\\n        \\\"status\\\": \\\"ACTIVE\\\"\\n      },\\n      \\\"onlineStore\\\": {\\n        \\\"templateSuffix\\\": \\\"\\\"\\n      }\\n    },\\n    \\\"redirectNewHandle\\\": false\\n  }\\n}\"}"}],"task_id":"shopify::admin::admin_api_operation","task_version":"0.1","task_type":"ACTION","description":"Updates metaobject","note":null,"name":"Send Admin API request"},{"step_id":"01f1f040-949b-11f0-9e8a-e92799661fe5","step_position":[1860,-20],"config_field_values":[{"config_field_id":"input","value":"query{\n  generateText{\n    text\n  }\n}"},{"config_field_id":"script","value":"export default function main(input) {\n  // Make sure that the data you return matches the\n  // shape & types defined in the output schema.\n\nconst text = JSON.stringify(input.generateText.text)\n\n  \n  return {\n    text: text,\n  }\n}"},{"config_field_id":"output_schema","value":"\"The output of Run Code\"\ntype Output {\n  \"The message returned by the script\"\n  text: String!\n}"}],"task_id":"shopify::flow::run_code","task_version":"0.1","task_type":"ACTION","description":"Normalizes responses to a string.","note":null,"name":"Run code (1)"}],"links":[{"from_step_id":"d071bc10-8a65-11f0-88f8-0b6c3725d20a","from_port_id":"output","to_step_id":"35620940-8a66-11f0-88f8-0b6c3725d20a","to_port_id":"input"},{"from_step_id":"35620940-8a66-11f0-88f8-0b6c3725d20a","from_port_id":"output","to_step_id":"49881e00-8a66-11f0-88f8-0b6c3725d20a","to_port_id":"input"},{"from_step_id":"49881e00-8a66-11f0-88f8-0b6c3725d20a","from_port_id":"output","to_step_id":"4d952fe0-8a68-11f0-88f8-0b6c3725d20a","to_port_id":"input"},{"from_step_id":"4d952fe0-8a68-11f0-88f8-0b6c3725d20a","from_port_id":"true","to_step_id":"b76130f0-8a67-11f0-88f8-0b6c3725d20a","to_port_id":"input"},{"from_step_id":"b76130f0-8a67-11f0-88f8-0b6c3725d20a","from_port_id":"output","to_step_id":"01f1f040-949b-11f0-9e8a-e92799661fe5","to_port_id":"input"},{"from_step_id":"01f1f040-949b-11f0-9e8a-e92799661fe5","from_port_id":"output","to_step_id":"661e9ec0-8a68-11f0-88f8-0b6c3725d20a","to_port_id":"input"}],"patched_fields":[{"id":"01991a52-3057-7361-b4e5-24b6e604985d","handle":"ccBundleSummaries","field":"ccBundleSummaries","patched_type":"metaobject_3387687119","arguments":"{\"key\":\"cc_bundle_summaries\"}","merchant_configured":false},{"id":"01991a52-3057-71d7-aa55-1ef1cb96984d","handle":"ccChannelBrandkitDescription","field":"ccChannelBrandkitDescription","patched_type":"metaobject_3387687119","arguments":"{\"key\":\"cc-channel-brandkit-description\"}","merchant_configured":false},{"id":"01991a52-3057-7a99-a839-089b944e5183","handle":"ccChannelBrandkitPrimaryColor","field":"ccChannelBrandkitPrimaryColor","patched_type":"metaobject_3387687119","arguments":"{\"key\":\"cc-channel-brandkit-primary-color\"}","merchant_configured":false},{"id":"01991a52-3057-7e56-8d8a-0ab9530b87aa","handle":"ccChannelBrandkitPrimaryLogo","field":"ccChannelBrandkitPrimaryLogo","patched_type":"metaobject_3387687119","arguments":"{\"key\":\"cc-channel-brandkit-primary-logo\"}","merchant_configured":false},{"id":"01991a52-3057-7799-8641-ba01e7998a37","handle":"ccChannelBrandkitTitle","field":"ccChannelBrandkitTitle","patched_type":"metaobject_3387687119","arguments":"{\"key\":\"cc-channel-brandkit-title\"}","merchant_configured":false},{"id":"01991a52-3057-7ad8-9624-154f2a23a28f","handle":"ccCollabAffiliateCode","field":"ccCollabAffiliateCode","patched_type":"metaobject_3387687119","arguments":"{\"key\":\"cc-collab-affiliate-code\"}","merchant_configured":false},{"id":"01991a52-3057-7a87-b949-2775ee967a1f","handle":"ccCollabAffiliateLink","field":"ccCollabAffiliateLink","patched_type":"metaobject_3387687119","arguments":"{\"key\":\"cc-collab-affiliate-link\"}","merchant_configured":false},{"id":"01991a52-3057-7a45-96b6-4f0f02bfc6db","handle":"ccCollabDiscountAmount","field":"ccCollabDiscountAmount","patched_type":"metaobject_3387687119","arguments":"{\"key\":\"cc-collab-discount-amount\"}","merchant_configured":false},{"id":"01991a52-3057-7753-9a35-4186bffc3b61","handle":"ccCollabDiscountCode","field":"ccCollabDiscountCode","patched_type":"metaobject_3387687119","arguments":"{\"key\":\"cc-collab-discount-code\"}","merchant_configured":false},{"id":"01991a52-3057-773f-9b07-eff5f008be69","handle":"ccCollabDiscountType","field":"ccCollabDiscountType","patched_type":"metaobject_3387687119","arguments":"{\"key\":\"cc-collab-discount-type\"}","merchant_configured":false},{"id":"01991a52-3057-727b-8cc8-90962ccf1643","handle":"ccCreatorCollection","field":"ccCreatorCollection","patched_type":"metaobject_3387687119","arguments":"{\"key\":\"cc-creator-collection\"}","merchant_configured":false},{"id":"01991a52-3057-7d12-8f97-e83f848d59de","handle":"ccCreatorDrops","field":"ccCreatorDrops","patched_type":"metaobject_3387687119","arguments":"{\"key\":\"cc-creator-drops\"}","merchant_configured":false},{"id":"01991a52-3057-74dc-bcfe-8c04ed5c993c","handle":"ccCreatorFirstName","field":"ccCreatorFirstName","patched_type":"metaobject_3387687119","arguments":"{\"key\":\"cc-creator-first-name\"}","merchant_configured":false},{"id":"01991a52-3057-7702-bbe7-31751983a4c0","handle":"ccCreatorLastName","field":"ccCreatorLastName","patched_type":"metaobject_3387687119","arguments":"{\"key\":\"cc-creator-last-name\"}","merchant_configured":false},{"id":"01991a52-3057-7a89-8ce6-03565acb0851","handle":"ccCreatorProducts","field":"ccCreatorProducts","patched_type":"metaobject_3387687119","arguments":"{\"key\":\"cc-creator-products\"}","merchant_configured":false},{"id":"01991a52-3057-7b18-85c6-299f276a056d","handle":"ccCreatorProfilePicture","field":"ccCreatorProfilePicture","patched_type":"metaobject_3387687119","arguments":"{\"key\":\"cc-creator-profile-picture\"}","merchant_configured":false},{"id":"01991a52-3057-7171-abbd-ee947853b306","handle":"ccCreatorShopDescription","field":"ccCreatorShopDescription","patched_type":"metaobject_3387687119","arguments":"{\"key\":\"cc-creator-shop-description\"}","merchant_configured":false},{"id":"01991a52-3057-73be-b349-0d1116bf745c","handle":"ccCreatorShopHandle","field":"ccCreatorShopHandle","patched_type":"metaobject_3387687119","arguments":"{\"key\":\"cc-creator-shop-handle\"}","merchant_configured":false},{"id":"01991a52-3057-76ab-b102-f62314b5b3b0","handle":"ccCreatorShopThemePrimaryColor","field":"ccCreatorShopThemePrimaryColor","patched_type":"metaobject_3387687119","arguments":"{\"key\":\"cc-creator-shop-theme-primary-color\"}","merchant_configured":false},{"id":"01991a52-3057-766c-ac93-406029929d4b","handle":"ccCreatorShopTitle","field":"ccCreatorShopTitle","patched_type":"metaobject_3387687119","arguments":"{\"key\":\"cc-creator-shop-title\"}","merchant_configured":false},{"id":"01991a52-3057-7d50-9ba3-38a3dc46ea92","handle":"data","field":"data","patched_type":"metaobject_3387687119","arguments":"{\"key\":\"data\"}","merchant_configured":false}],"variables":[],"note":null,"workflow_name":"CC // Summarize each drop to 4 overall features"}}