8c837d404b0a39554faa519356b0b9ae81b0102dd1a6255031dcb9127b3316f8:{"__metadata":{"version":0.1},"root":{"steps":[{"step_id":"01K9XEX5AND68NPNCKQBN1KJVQ","step_position":[-760,0],"config_field_values":[],"task_id":"fa0550f6-ef7d-4210-b6d8-6c42169e5f86","task_version":"1.0","task_type":"TRIGGER","description":null,"note":null,"name":null},{"step_id":"01K9XEZFPYHJRP0951GBA96FRT","step_position":[-60,0],"config_field_values":[{"config_field_id":"type","value":"creator"},{"config_field_id":"handle","value":"{{ccCreatorShopHandle}}"}],"task_id":"shopify::flow::fetch::metaobject","task_version":"v1","task_type":"ACTION","description":"Gets the Creator metaobject","note":null,"name":"Get metaobject entry"},{"step_id":"01K9XF14M3B44QH3HF8EWEE4Q2","step_position":[260,0],"config_field_values":[{"config_field_id":"input","value":"query{\n  getMetaobjectEntry{\n    data\n  }\n}"},{"config_field_id":"script","value":"export default function main(input) {\n  const parsed =\n    typeof input.getMetaobjectEntry.data === \"string\"\n      ? JSON.parse(input.getMetaobjectEntry.data)\n      : input.getMetaobjectEntry.data;\n\n  const customerGid = parsed[\"cc-creator-customer\"] || \"\";\n  const customerId = customerGid.replace(/^.*\\//, \"\");\n\n  const drops = parsed[\"cc-creator-drops\"] || [];\n  const hasDrops = Array.isArray(drops) && drops.length > 0;\n\n  const collabId = parsed[\"cc-collab-id\"];\n\n  return {\n      customerId: customerId,\n    hasDrops: hasDrops,\n    collabId: collabId\n  };\n}"},{"config_field_id":"output_schema","value":"\"The output of Run Code\"\ntype Output {\n  \"The message returned by the script\"\n  customerId: String!\n   hasDrops: Boolean!\n  collabId: String!\n}"}],"task_id":"shopify::flow::run_code","task_version":"0.1","task_type":"ACTION","description":"Processes data into usable fields","note":null,"name":"Run code"},{"step_id":"01K9XF1P5S4QMGT98THA2ERE83","step_position":[1060,0],"config_field_values":[{"config_field_id":"sort_by","value":"{\"sortKey\":\"CREATED_AT\",\"order\":\"ASCENDING\"}"},{"config_field_id":"max_root_records","value":"1"},{"config_field_id":"query","value":"customer_id:{{runCode.customerId}}"}],"task_id":"shopify::flow::fetch::orders","task_version":"v1","task_type":"ACTION","description":"Gets recent order","note":null,"name":"Get order data"},{"step_id":"01K9XF7K1FGEVWBJA9903J6WCP","step_position":[-400,0],"config_field_values":[{"config_field_id":"wait_duration","value":"{\"amount\":\"20\",\"unit\":\"seconds\"}"}],"task_id":"shopify::flow::wait","task_version":"0.1","task_type":"WAIT","description":"Waits to prevent duplications","note":null,"name":null},{"step_id":"01K9XF8SMV8Q8YJ29BJBGJJ9NK","step_position":[1860,-20],"config_field_values":[{"config_field_id":"method","value":"POST"},{"config_field_id":"url","value":"https://unified-api.creatorcommerce.shop/creators/collabs/{{runCode.collabId}}/drops"},{"config_field_id":"headers","value":"[[\"x-channel-access-token\",\"{{secrets.ccApiKey}}\"],[\"Content-Type\",\"application/json\"]]"},{"config_field_id":"body","value":"{\n    \"title\": \"Purchased by {{getMetaobjectEntry.ccCreatorFirstName}}\",\n    \"description\": \"Products {{getMetaobjectEntry.ccCreatorFirstName}} has verifiably tried before.\",\n    \"products\": [{% for getOrderData_item in getOrderData %}{% for lineItems_item in getOrderData_item.lineItems %}{\"id\":\"{{lineItems_item.product.id | remove: 'gid://shopify/Product/'}}\"}{% unless forloop.last %},{% endunless %}{% endfor %}{% endfor %}]\n}"},{"config_field_id":"on_client_error","value":"fail"},{"config_field_id":"on_server_error","value":"fail"}],"task_id":"shopify::flow::send_http","task_version":"2.0","task_type":"ACTION","description":"Makes a CreatorCommerce Drop (Collection)","note":null,"name":"Send HTTP request"},{"step_id":"01KA01CEJERCNDF92B25HKG0A1","step_position":[640,0],"config_field_values":[{"config_field_id":"condition","value":"{\"uuid\":\"7cd68da2-c0fd-11f0-9ae8-1b489a8c56a4\",\"lhs\":{\"uuid\":\"79764ba0-c0fd-11f0-9ae8-1b489a8c56a4\",\"parent_uuid\":\"7cd68da2-c0fd-11f0-9ae8-1b489a8c56a4\",\"lhs\":{\"uuid\":\"7cd68da0-c0fd-11f0-9ae8-1b489a8c56a4\",\"parent_uuid\":\"79764ba0-c0fd-11f0-9ae8-1b489a8c56a4\",\"value\":\"runCode.hasDrops\",\"comparison_value_type\":\"EnvironmentValue\",\"full_environment_path\":\"runCode.hasDrops\"},\"rhs\":{\"uuid\":\"8e670360-c0fd-11f0-9ae8-1b489a8c56a4\",\"parent_uuid\":\"79764ba0-c0fd-11f0-9ae8-1b489a8c56a4\",\"value\":\"false\",\"comparison_value_type\":\"LiteralValue\"},\"value_type\":\"EnvironmentScalarDefinition:Boolean\",\"operator\":\"==\",\"operation_type\":\"Comparison\"},\"operator\":\"AND\",\"operation_type\":\"LogicalExpression\"}"}],"task_id":"shopify::flow::condition","task_version":"0.1","task_type":"CONDITION","description":"Ensures it is allowed to proceed (no drops)","note":null,"name":null},{"step_id":"01KA9T9HS81DVAVXC71F7706T8","step_position":[1460,-20],"config_field_values":[{"config_field_id":"condition","value":"{\"uuid\":\"7e466122-c3f9-11f0-887f-29c289156e36\",\"lhs\":{\"uuid\":\"7e463a10-c3f9-11f0-887f-29c289156e36\",\"parent_uuid\":\"7e466122-c3f9-11f0-887f-29c289156e36\",\"array_path\":{\"uuid\":\"7e463a11-c3f9-11f0-887f-29c289156e36\",\"parent_uuid\":\"7e463a10-c3f9-11f0-887f-29c289156e36\",\"value\":\"getOrderData\",\"comparison_value_type\":\"EnvironmentValue\"},\"array_item_key\":{\"uuid\":\"7e463a12-c3f9-11f0-887f-29c289156e36\",\"parent_uuid\":\"7e463a10-c3f9-11f0-887f-29c289156e36\",\"value\":\"getOrderData_item\",\"comparison_value_type\":\"EnvironmentValue\"},\"operation\":{\"uuid\":\"7e463a13-c3f9-11f0-887f-29c289156e36\",\"parent_uuid\":\"7e463a10-c3f9-11f0-887f-29c289156e36\",\"lhs\":{\"uuid\":\"7e463a14-c3f9-11f0-887f-29c289156e36\",\"parent_uuid\":\"7e463a13-c3f9-11f0-887f-29c289156e36\",\"lhs\":{\"uuid\":\"7e466120-c3f9-11f0-887f-29c289156e36\",\"parent_uuid\":\"7e463a14-c3f9-11f0-887f-29c289156e36\",\"value\":\"getOrderData_item.number\",\"comparison_value_type\":\"EnvironmentValue\",\"full_environment_path\":\"getOrderData_item.number\"},\"rhs\":{\"uuid\":\"446b0c00-c55a-11f0-baad-71e71c3bda8d\",\"parent_uuid\":\"7e463a14-c3f9-11f0-887f-29c289156e36\",\"value\":\"\",\"comparison_value_type\":\"LiteralValue\"},\"value_type\":\"EnvironmentScalarDefinition:Int\",\"operator\":\"not_nil?\",\"operation_type\":\"Comparison\"},\"operator\":\"AND\",\"operation_type\":\"LogicalExpression\"},\"operator\":\"ANY\",\"operation_type\":\"ArrayExpression\"},\"operator\":\"AND\",\"operation_type\":\"LogicalExpression\"}"}],"task_id":"shopify::flow::condition","task_version":"0.1","task_type":"CONDITION","description":"Checks if there is an order","note":null,"name":null}],"links":[{"from_step_id":"01K9XEZFPYHJRP0951GBA96FRT","from_port_id":"output","to_step_id":"01K9XF14M3B44QH3HF8EWEE4Q2","to_port_id":"input"},{"from_step_id":"01K9XEX5AND68NPNCKQBN1KJVQ","from_port_id":"output","to_step_id":"01K9XF7K1FGEVWBJA9903J6WCP","to_port_id":"input"},{"from_step_id":"01K9XF7K1FGEVWBJA9903J6WCP","from_port_id":"output","to_step_id":"01K9XEZFPYHJRP0951GBA96FRT","to_port_id":"input"},{"from_step_id":"01K9XF14M3B44QH3HF8EWEE4Q2","from_port_id":"output","to_step_id":"01KA01CEJERCNDF92B25HKG0A1","to_port_id":"input"},{"from_step_id":"01KA01CEJERCNDF92B25HKG0A1","from_port_id":"true","to_step_id":"01K9XF1P5S4QMGT98THA2ERE83","to_port_id":"input"},{"from_step_id":"01K9XF1P5S4QMGT98THA2ERE83","from_port_id":"output","to_step_id":"01KA9T9HS81DVAVXC71F7706T8","to_port_id":"input"},{"from_step_id":"01KA9T9HS81DVAVXC71F7706T8","from_port_id":"true","to_step_id":"01K9XF8SMV8Q8YJ29BJBGJJ9NK","to_port_id":"input"}],"patched_fields":[{"id":"01K9XEZPEREC2E1ES9YTMZHW78","handle":"ccChannelBrandkitDescription","field":"ccChannelBrandkitDescription","patched_type":"metaobject_10999103855","arguments":"{\"key\":\"cc-channel-brandkit-description\"}","merchant_configured":false},{"id":"01K9XEZPERVWRVRMTTVYQ7A040","handle":"ccChannelBrandkitPrimaryColor","field":"ccChannelBrandkitPrimaryColor","patched_type":"metaobject_10999103855","arguments":"{\"key\":\"cc-channel-brandkit-primary-color\"}","merchant_configured":false},{"id":"01K9XEZPERWKMKMSN6QJV17EWV","handle":"ccChannelBrandkitPrimaryLogo","field":"ccChannelBrandkitPrimaryLogo","patched_type":"metaobject_10999103855","arguments":"{\"key\":\"cc-channel-brandkit-primary-logo\"}","merchant_configured":false},{"id":"01K9XEZPERP3421HY3NEHPCJCP","handle":"ccChannelBrandkitTitle","field":"ccChannelBrandkitTitle","patched_type":"metaobject_10999103855","arguments":"{\"key\":\"cc-channel-brandkit-title\"}","merchant_configured":false},{"id":"01K9XEZPERHGTNY9YC7H8RK7KW","handle":"ccCollabAffiliateCode","field":"ccCollabAffiliateCode","patched_type":"metaobject_10999103855","arguments":"{\"key\":\"cc-collab-affiliate-code\"}","merchant_configured":false},{"id":"01K9XEZPERKXD7J67S17YS0XAB","handle":"ccCollabAffiliateLink","field":"ccCollabAffiliateLink","patched_type":"metaobject_10999103855","arguments":"{\"key\":\"cc-collab-affiliate-link\"}","merchant_configured":false},{"id":"01K9XEZPERCSEW91DTFXGMZ4XS","handle":"ccCollabDiscountAmount","field":"ccCollabDiscountAmount","patched_type":"metaobject_10999103855","arguments":"{\"key\":\"cc-collab-discount-amount\"}","merchant_configured":false},{"id":"01K9XEZPERHB0Q7DP3WA7E1HA7","handle":"ccCollabDiscountCode","field":"ccCollabDiscountCode","patched_type":"metaobject_10999103855","arguments":"{\"key\":\"cc-collab-discount-code\"}","merchant_configured":false},{"id":"01K9XEZPER891D88AF20HR91KG","handle":"ccCollabDiscountType","field":"ccCollabDiscountType","patched_type":"metaobject_10999103855","arguments":"{\"key\":\"cc-collab-discount-type\"}","merchant_configured":false},{"id":"01K9XEZPERYTK7DAB1BAYHHM21","handle":"ccCreatorCollection","field":"ccCreatorCollection","patched_type":"metaobject_10999103855","arguments":"{\"key\":\"cc-creator-collection\"}","merchant_configured":false},{"id":"01K9XEZPERQ6D9YAFKBS6WJ90A","handle":"ccCreatorDrops","field":"ccCreatorDrops","patched_type":"metaobject_10999103855","arguments":"{\"key\":\"cc-creator-drops\"}","merchant_configured":false},{"id":"01K9XEZPER7MZ0MVTZW8CM4WJH","handle":"ccCreatorFirstName","field":"ccCreatorFirstName","patched_type":"metaobject_10999103855","arguments":"{\"key\":\"cc-creator-first-name\"}","merchant_configured":false},{"id":"01K9XEZPERQK2VZCRYTEYEMZJF","handle":"ccCreatorLastName","field":"ccCreatorLastName","patched_type":"metaobject_10999103855","arguments":"{\"key\":\"cc-creator-last-name\"}","merchant_configured":false},{"id":"01K9XEZPERVXGNXBG3RQ9F0N8P","handle":"ccCreatorProducts","field":"ccCreatorProducts","patched_type":"metaobject_10999103855","arguments":"{\"key\":\"cc-creator-products\"}","merchant_configured":false},{"id":"01K9XEZPERVM213X31ZWWSZQPJ","handle":"ccCreatorProfilePicture","field":"ccCreatorProfilePicture","patched_type":"metaobject_10999103855","arguments":"{\"key\":\"cc-creator-profile-picture\"}","merchant_configured":false},{"id":"01K9XEZPERP2T6CETNA0GJ3VQ7","handle":"ccCreatorShopDescription","field":"ccCreatorShopDescription","patched_type":"metaobject_10999103855","arguments":"{\"key\":\"cc-creator-shop-description\"}","merchant_configured":false},{"id":"01K9XEZPER0VMZ4EF6HTHFPZ65","handle":"ccCreatorShopHandle","field":"ccCreatorShopHandle","patched_type":"metaobject_10999103855","arguments":"{\"key\":\"cc-creator-shop-handle\"}","merchant_configured":false},{"id":"01K9XEZPERWGG83CN5W6HJ798J","handle":"ccCreatorShopThemePrimaryColor","field":"ccCreatorShopThemePrimaryColor","patched_type":"metaobject_10999103855","arguments":"{\"key\":\"cc-creator-shop-theme-primary-color\"}","merchant_configured":false},{"id":"01K9XEZPERSFKW7V7XZY6Q04VQ","handle":"ccCreatorShopTitle","field":"ccCreatorShopTitle","patched_type":"metaobject_10999103855","arguments":"{\"key\":\"cc-creator-shop-title\"}","merchant_configured":false},{"id":"01K9XEZPER6VVNBN697PT9TAYS","handle":"data","field":"data","patched_type":"metaobject_10999103855","arguments":"{\"key\":\"data\"}","merchant_configured":false}],"variables":[],"note":null,"vertical_layout_enabled":false,"workflow_name":"CC // Create default collections with most recent order"}}