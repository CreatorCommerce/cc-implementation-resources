5399868d08cdb951e9c039c8c9bbb7256c1945dfb4eab0b24ce69a894b92e49d:{"__metadata":{"version":0.1},"root":{"steps":[{"step_id":"3dff3a80-a2e6-11f0-b0a6-41414d767008","step_position":[0,0],"config_field_values":[],"task_id":"fa0550f6-ef7d-4210-b6d8-6c42169e5f86","task_version":"1.0","task_type":"TRIGGER","description":null,"note":null,"name":null},{"step_id":"dd718eb0-a2e6-11f0-b0a6-41414d767008","step_position":[1800,0],"config_field_values":[{"config_field_id":"method","value":"POST"},{"config_field_id":"url","value":"https://unified-api.creatorcommerce.shop/creators/collabs/{{runCode.collabId}}?myshopify_domain={{shop.myshopifyDomain}}"},{"config_field_id":"headers","value":"[[\"x-channel-access-token\",\"{{secrets.ccApiKey}}\"],[\"Content-Type\",\"application/json\"]]"},{"config_field_id":"body","value":"{\n\"myshopifyDomain\": \"{{shop.myshopifyDomain}}\",\n\"affiliateUrl\":\"{{shop.primaryDomain.url}}/{{ccCreatorShopHandle}}\",\n\"handle\":\"{{ccCreatorShopHandle}}\",\n\"custom\": {\n\"cc-affiliate-url-reset\":\"T\"\n}\n}"},{"config_field_id":"on_client_error","value":"retry"},{"config_field_id":"on_server_error","value":"retry"}],"task_id":"shopify::flow::send_http","task_version":"2.0","task_type":"ACTION","description":"Update the creator with the affiliate link with intended format. Update {{ccCreatorShopHandle}} in both places with the intended link slug","note":null,"name":"Send HTTP request"},{"step_id":"99dbbd80-a2e9-11f0-bbb3-2949b1baec26","step_position":[720,0],"config_field_values":[{"config_field_id":"type","value":"creator"},{"config_field_id":"handle","value":"{{ccCreatorShopHandle}}"}],"task_id":"shopify::flow::fetch::metaobject","task_version":"v1","task_type":"ACTION","description":"Get all CreatorCommerce data.","note":null,"name":"Get metaobject entry"},{"step_id":"a3a032b0-a2e9-11f0-bbb3-2949b1baec26","step_position":[1080,0],"config_field_values":[{"config_field_id":"input","value":"query{\n  getMetaobjectEntry{\n    data\n  }\n}"},{"config_field_id":"script","value":"export default function main(input) {\n  const parsed = JSON.parse(input.getMetaobjectEntry.data);\n\n  const affiliateUrlReset = parsed[\"cc-affiliate-url-reset\"];\n  const collabId = parsed[\"cc-collab-id\"];\n\n  const truthyValues = [\"t\", \"y\", \"yes\", \"true\"];\n  const isReset = truthyValues.includes(String(affiliateUrlReset).toLowerCase());\n\n  return { \n    affiliateUrlReset: isReset,\n    collabId: collabId\n  };\n}"},{"config_field_id":"output_schema","value":"\"The output of Run Code\"\ntype Output {\n  \"The message returned by the script\"\n  affiliateUrlReset: Boolean!\n  collabId: String!\n}"}],"task_id":"shopify::flow::run_code","task_version":"0.1","task_type":"ACTION","description":"Checks if the affiliate link has been reset by CreatorCommerce before.","note":null,"name":"Run code"},{"step_id":"46a7ccb0-a318-11f0-9a6b-49429d095059","step_position":[1440,0],"config_field_values":[{"config_field_id":"condition","value":"{\"uuid\":\"4918a5a2-a318-11f0-9a6b-49429d095059\",\"lhs\":{\"uuid\":\"47f84180-a318-11f0-9a6b-49429d095059\",\"parent_uuid\":\"4918a5a2-a318-11f0-9a6b-49429d095059\",\"lhs\":{\"uuid\":\"4918a5a0-a318-11f0-9a6b-49429d095059\",\"parent_uuid\":\"47f84180-a318-11f0-9a6b-49429d095059\",\"value\":\"runCode.affiliateUrlReset\",\"comparison_value_type\":\"EnvironmentValue\",\"full_environment_path\":\"runCode.affiliateUrlReset\"},\"rhs\":{\"uuid\":\"4a6f5c01-a318-11f0-9a6b-49429d095059\",\"parent_uuid\":\"47f84180-a318-11f0-9a6b-49429d095059\",\"value\":\"false\",\"comparison_value_type\":\"LiteralValue\"},\"value_type\":\"EnvironmentScalarDefinition:Boolean\",\"operator\":\"==\",\"operation_type\":\"Comparison\"},\"operator\":\"AND\",\"operation_type\":\"LogicalExpression\"}"}],"task_id":"shopify::flow::condition","task_version":"0.1","task_type":"CONDITION","description":"See if CreatorCommerce has reset & taken over the affiliate link before.","note":null,"name":null},{"step_id":"128d84e0-a324-11f0-810b-b99174f1a4ae","step_position":[380,0],"config_field_values":[{"config_field_id":"wait_duration","value":"{\"amount\":\"3\",\"unit\":\"seconds\"}"}],"task_id":"shopify::flow::wait","task_version":"0.1","task_type":"WAIT","description":null,"note":null,"name":null}],"links":[{"from_step_id":"99dbbd80-a2e9-11f0-bbb3-2949b1baec26","from_port_id":"output","to_step_id":"a3a032b0-a2e9-11f0-bbb3-2949b1baec26","to_port_id":"input"},{"from_step_id":"a3a032b0-a2e9-11f0-bbb3-2949b1baec26","from_port_id":"output","to_step_id":"46a7ccb0-a318-11f0-9a6b-49429d095059","to_port_id":"input"},{"from_step_id":"46a7ccb0-a318-11f0-9a6b-49429d095059","from_port_id":"true","to_step_id":"dd718eb0-a2e6-11f0-b0a6-41414d767008","to_port_id":"input"},{"from_step_id":"3dff3a80-a2e6-11f0-b0a6-41414d767008","from_port_id":"output","to_step_id":"128d84e0-a324-11f0-810b-b99174f1a4ae","to_port_id":"input"},{"from_step_id":"128d84e0-a324-11f0-810b-b99174f1a4ae","from_port_id":"output","to_step_id":"99dbbd80-a2e9-11f0-bbb3-2949b1baec26","to_port_id":"input"}],"patched_fields":[{"id":"0199bc25-e90d-784a-b0fb-459e0837cf16","handle":"ccChannelBrandkitDescription","field":"ccChannelBrandkitDescription","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"cc-channel-brandkit-description\"}","merchant_configured":false},{"id":"0199bc25-e90d-76b4-8ed5-5888fca93d64","handle":"ccChannelBrandkitPrimaryColor","field":"ccChannelBrandkitPrimaryColor","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"cc-channel-brandkit-primary-color\"}","merchant_configured":false},{"id":"0199bc25-e90d-76bd-8c1b-66b173ba105b","handle":"ccChannelBrandkitPrimaryLogo","field":"ccChannelBrandkitPrimaryLogo","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"cc-channel-brandkit-primary-logo\"}","merchant_configured":false},{"id":"0199bc25-e90d-7a58-9542-d64334fbb411","handle":"ccChannelBrandkitTitle","field":"ccChannelBrandkitTitle","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"cc-channel-brandkit-title\"}","merchant_configured":false},{"id":"0199bc25-e90d-72b6-bb29-d666302bf9fc","handle":"ccCollabAffiliateCode","field":"ccCollabAffiliateCode","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"cc-collab-affiliate-code\"}","merchant_configured":false},{"id":"0199bc25-e90d-7453-b7fc-2bd149e93a89","handle":"ccCollabAffiliateLink","field":"ccCollabAffiliateLink","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"cc-collab-affiliate-link\"}","merchant_configured":false},{"id":"0199bc25-e90d-72ba-a0ac-98964ee54d05","handle":"ccCollabDiscountAmount","field":"ccCollabDiscountAmount","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"cc-collab-discount-amount\"}","merchant_configured":false},{"id":"0199bc25-e90d-70bf-b360-20802d465cf6","handle":"ccCollabDiscountCode","field":"ccCollabDiscountCode","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"cc-collab-discount-code\"}","merchant_configured":false},{"id":"0199bc25-e90d-7f19-83f5-71be30fbedcb","handle":"ccCollabDiscountType","field":"ccCollabDiscountType","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"cc-collab-discount-type\"}","merchant_configured":false},{"id":"0199bc25-e90d-7ea1-9a15-b1a8575cfe5f","handle":"ccCreatorCollection","field":"ccCreatorCollection","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"cc-creator-collection\"}","merchant_configured":false},{"id":"0199bc25-e90d-7e90-b96c-10cf82c133a1","handle":"ccCreatorDrops","field":"ccCreatorDrops","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"cc-creator-drops\"}","merchant_configured":false},{"id":"0199bc25-e90d-7e4f-9255-35d8c8288425","handle":"ccCreatorFirstName","field":"ccCreatorFirstName","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"cc-creator-first-name\"}","merchant_configured":false},{"id":"0199bc25-e90d-7c41-a4de-bb9cd1b46d5f","handle":"ccCreatorLastName","field":"ccCreatorLastName","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"cc-creator-last-name\"}","merchant_configured":false},{"id":"0199bc25-e90d-7573-be4b-11848776bb28","handle":"ccCreatorProducts","field":"ccCreatorProducts","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"cc-creator-products\"}","merchant_configured":false},{"id":"0199bc25-e90d-7947-9fa4-bd249bd9de17","handle":"ccCreatorProfilePicture","field":"ccCreatorProfilePicture","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"cc-creator-profile-picture\"}","merchant_configured":false},{"id":"0199bc25-e90d-70db-8b6f-99730c575ed4","handle":"ccCreatorShopDescription","field":"ccCreatorShopDescription","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"cc-creator-shop-description\"}","merchant_configured":false},{"id":"0199bc25-e90d-742e-b1f9-976a85341e99","handle":"ccCreatorShopHandle","field":"ccCreatorShopHandle","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"cc-creator-shop-handle\"}","merchant_configured":false},{"id":"0199bc25-e90d-743d-a7f0-32c9633d23d1","handle":"ccCreatorShopThemePrimaryColor","field":"ccCreatorShopThemePrimaryColor","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"cc-creator-shop-theme-primary-color\"}","merchant_configured":false},{"id":"0199bc25-e90d-7212-9d5e-a14be6f878ce","handle":"ccCreatorShopTitle","field":"ccCreatorShopTitle","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"cc-creator-shop-title\"}","merchant_configured":false},{"id":"0199bc25-e90d-75d7-a75f-701070c1939f","handle":"data","field":"data","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"data\"}","merchant_configured":false}],"variables":[],"note":null,"workflow_name":"CC // Set initial link for CreatorCommerce managed affiliate links"}}