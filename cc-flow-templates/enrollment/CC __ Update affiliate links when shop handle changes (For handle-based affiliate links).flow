55769367ae9444204f9b38fe9ca2261ec03ed7859df84a083c2163ce01ba0f47:{"__metadata":{"version":0.1},"root":{"steps":[{"step_id":"3dff3a80-a2e6-11f0-b0a6-41414d767008","step_position":[-840,-20],"config_field_values":[],"task_id":"fa0550f6-ef7d-4210-b6d8-6c42169e5f86","task_version":"1.0","task_type":"TRIGGER","description":null,"note":null,"name":null},{"step_id":"675f1df0-a2e6-11f0-b0a6-41414d767008","step_position":[-180,-20],"config_field_values":[{"config_field_id":"condition","value":"{\"uuid\":\"760a2702-a2e6-11f0-b0a6-41414d767008\",\"lhs\":{\"uuid\":\"691b25d0-a2e6-11f0-b0a6-41414d767008\",\"parent_uuid\":\"760a2702-a2e6-11f0-b0a6-41414d767008\",\"lhs\":{\"uuid\":\"760a2700-a2e6-11f0-b0a6-41414d767008\",\"parent_uuid\":\"691b25d0-a2e6-11f0-b0a6-41414d767008\",\"value\":\"ccCreatorAffiliateUrlPrev\",\"comparison_value_type\":\"EnvironmentValue\",\"full_environment_path\":\"ccCreatorAffiliateUrlPrev\"},\"rhs\":{\"uuid\":\"16e80ba0-a4b4-11f0-bb59-1107f2dbb3db\",\"parent_uuid\":\"691b25d0-a2e6-11f0-b0a6-41414d767008\",\"value\":\"\",\"comparison_value_type\":\"LiteralValue\"},\"value_type\":\"EnvironmentScalarDefinition:String\",\"operator\":\"not_empty_and_not_nil?\",\"operation_type\":\"Comparison\"},\"operator\":\"AND\",\"operation_type\":\"LogicalExpression\"}"}],"task_id":"shopify::flow::condition","task_version":"0.1","task_type":"CONDITION","description":"There is a previous affiliate URL","note":null,"name":null},{"step_id":"dd718eb0-a2e6-11f0-b0a6-41414d767008","step_position":[1880,-20],"config_field_values":[{"config_field_id":"method","value":"POST"},{"config_field_id":"url","value":"https://unified-api.creatorcommerce.shop/creators/collabs/{{runCode.collabId}}?myshopify_domain={{shop.myshopifyDomain}}"},{"config_field_id":"headers","value":"[[\"x-channel-access-token\",\"{{secrets.ccApiKey}}\"],[\"Content-Type\",\"application/json\"]]"},{"config_field_id":"body","value":"{\n\"myshopifyDomain\": \"{{shop.myshopifyDomain}}\",\n\"affiliateUrl\":\"{{shop.primaryDomain.url}}/{{ccCreatorShopHandle}}\"\n}"},{"config_field_id":"on_client_error","value":"retry"},{"config_field_id":"on_server_error","value":"retry"}],"task_id":"shopify::flow::send_http","task_version":"2.0","task_type":"ACTION","description":"Update the affiliate link with the API.","note":null,"name":"Send HTTP request"},{"step_id":"99dbbd80-a2e9-11f0-bbb3-2949b1baec26","step_position":[1140,-20],"config_field_values":[{"config_field_id":"type","value":"creator"},{"config_field_id":"handle","value":"{{ccCreatorShopHandle}}"}],"task_id":"shopify::flow::fetch::metaobject","task_version":"v1","task_type":"ACTION","description":"Get all CreatorCommerce data for the creator.","note":null,"name":"Get metaobject entry"},{"step_id":"a3a032b0-a2e9-11f0-bbb3-2949b1baec26","step_position":[1500,-20],"config_field_values":[{"config_field_id":"input","value":"query{\n  getMetaobjectEntry{\n    data\n  }\n}"},{"config_field_id":"script","value":"export default function main(input) {\n  const parsed = JSON.parse(input.getMetaobjectEntry.data);\n\n const collabId = parsed[\"cc-collab-id\"];\n\n  return {\n    collabId: collabId\n  };\n}\n\n"},{"config_field_id":"output_schema","value":"\"The output of Run Code\"\ntype Output {\n  \"The message returned by the script\"\n  collabId: String!\n}"}],"task_id":"shopify::flow::run_code","task_version":"0.1","task_type":"ACTION","description":"Saves the Collab ID for use in the API.","note":null,"name":"Run code"},{"step_id":"8c4cd530-a31d-11f0-932d-d340c99d2c5b","step_position":[140,-20],"config_field_values":[{"config_field_id":"condition","value":"{\"uuid\":\"8e5c2d32-a31d-11f0-932d-d340c99d2c5b\",\"lhs\":{\"uuid\":\"8d7acde0-a31d-11f0-932d-d340c99d2c5b\",\"parent_uuid\":\"8e5c2d32-a31d-11f0-932d-d340c99d2c5b\",\"lhs\":{\"uuid\":\"8e5c2d30-a31d-11f0-932d-d340c99d2c5b\",\"parent_uuid\":\"8d7acde0-a31d-11f0-932d-d340c99d2c5b\",\"value\":\"ccCreatorAffiliateUrl\",\"comparison_value_type\":\"EnvironmentValue\",\"full_environment_path\":\"ccCreatorAffiliateUrl\"},\"rhs\":{\"uuid\":\"90dcbd90-a31d-11f0-932d-d340c99d2c5b\",\"parent_uuid\":\"8d7acde0-a31d-11f0-932d-d340c99d2c5b\",\"value\":\"ccCreatorAffiliateUrlPrev\",\"comparison_value_type\":\"EnvironmentValue\"},\"value_type\":\"EnvironmentScalarDefinition:String\",\"operator\":\"!=\",\"operation_type\":\"Comparison\"},\"operator\":\"AND\",\"operation_type\":\"LogicalExpression\"}"}],"task_id":"shopify::flow::condition","task_version":"0.1","task_type":"CONDITION","description":"Checks is the previous URL is not equal to the current URL (if it is new).","note":null,"name":null},{"step_id":"5bc33260-a322-11f0-abef-7d8c294c4e58","step_position":[800,-20],"config_field_values":[{"config_field_id":"condition","value":"{\"uuid\":\"5f6d9cc2-a322-11f0-abef-7d8c294c4e58\",\"lhs\":{\"uuid\":\"5d7946d0-a322-11f0-abef-7d8c294c4e58\",\"parent_uuid\":\"5f6d9cc2-a322-11f0-abef-7d8c294c4e58\",\"lhs\":{\"uuid\":\"5f6d9cc0-a322-11f0-abef-7d8c294c4e58\",\"parent_uuid\":\"5d7946d0-a322-11f0-abef-7d8c294c4e58\",\"value\":\"ccCreatorAffiliateUrl\",\"comparison_value_type\":\"EnvironmentValue\",\"full_environment_path\":\"ccCreatorAffiliateUrl\"},\"rhs\":{\"uuid\":\"66b9a270-a323-11f0-870c-256a1f5f8345\",\"parent_uuid\":\"5d7946d0-a322-11f0-abef-7d8c294c4e58\",\"value\":\"runCode1.url\",\"comparison_value_type\":\"EnvironmentValue\"},\"value_type\":\"EnvironmentScalarDefinition:String\",\"operator\":\"!=\",\"operation_type\":\"Comparison\"},\"operator\":\"AND\",\"operation_type\":\"LogicalExpression\"}"}],"task_id":"shopify::flow::condition","task_version":"0.1","task_type":"CONDITION","description":"Checks is the current URL is not equal to the expected URL (if it is new).","note":null,"name":null},{"step_id":"34afba80-a323-11f0-870c-256a1f5f8345","step_position":[460,-20],"config_field_values":[{"config_field_id":"input","value":"query{\n  ccCreatorShopHandle\n  shop {\n    myshopifyDomain\n    primaryDomain {\n      url\n    }\n  }\n}"},{"config_field_id":"script","value":"export default function main(input) {\n  // Make sure that the data you return matches the\n  // shape & types defined in the output schema.\n  return {\n    url: `${input.shop.primaryDomain.url}/${input.ccCreatorShopHandle}`\n  }\n}"},{"config_field_id":"output_schema","value":"\"The output of Run Code\"\ntype Output {\n  \"The message returned by the script\"\n  url: String!\n}"}],"task_id":"shopify::flow::run_code","task_version":"0.1","task_type":"ACTION","description":"Compares a recreation of the expected affiliate link to do a more thorough comparison.","note":null,"name":"Run code (1)"},{"step_id":"e407e1b0-a323-11f0-bfd7-c5690dea0aa6","step_position":[-520,-20],"config_field_values":[{"config_field_id":"wait_duration","value":"{\"amount\":\"5\",\"unit\":\"seconds\"}"}],"task_id":"shopify::flow::wait","task_version":"0.1","task_type":"WAIT","description":null,"note":null,"name":null}],"links":[{"from_step_id":"99dbbd80-a2e9-11f0-bbb3-2949b1baec26","from_port_id":"output","to_step_id":"a3a032b0-a2e9-11f0-bbb3-2949b1baec26","to_port_id":"input"},{"from_step_id":"a3a032b0-a2e9-11f0-bbb3-2949b1baec26","from_port_id":"output","to_step_id":"dd718eb0-a2e6-11f0-b0a6-41414d767008","to_port_id":"input"},{"from_step_id":"675f1df0-a2e6-11f0-b0a6-41414d767008","from_port_id":"true","to_step_id":"8c4cd530-a31d-11f0-932d-d340c99d2c5b","to_port_id":"input"},{"from_step_id":"5bc33260-a322-11f0-abef-7d8c294c4e58","from_port_id":"true","to_step_id":"99dbbd80-a2e9-11f0-bbb3-2949b1baec26","to_port_id":"input"},{"from_step_id":"8c4cd530-a31d-11f0-932d-d340c99d2c5b","from_port_id":"true","to_step_id":"34afba80-a323-11f0-870c-256a1f5f8345","to_port_id":"input"},{"from_step_id":"34afba80-a323-11f0-870c-256a1f5f8345","from_port_id":"output","to_step_id":"5bc33260-a322-11f0-abef-7d8c294c4e58","to_port_id":"input"},{"from_step_id":"3dff3a80-a2e6-11f0-b0a6-41414d767008","from_port_id":"output","to_step_id":"e407e1b0-a323-11f0-bfd7-c5690dea0aa6","to_port_id":"input"},{"from_step_id":"e407e1b0-a323-11f0-bfd7-c5690dea0aa6","from_port_id":"output","to_step_id":"675f1df0-a2e6-11f0-b0a6-41414d767008","to_port_id":"input"}],"patched_fields":[{"id":"0199baf9-4be1-7b73-8dee-dae7a239bac2","handle":"ccChannelBrandkitDescription","field":"ccChannelBrandkitDescription","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"cc-channel-brandkit-description\"}","merchant_configured":false},{"id":"0199baf9-4be1-7b5f-a49e-24f27bee3327","handle":"ccChannelBrandkitPrimaryColor","field":"ccChannelBrandkitPrimaryColor","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"cc-channel-brandkit-primary-color\"}","merchant_configured":false},{"id":"0199baf9-4be1-7b62-bea8-144bf06d5d14","handle":"ccChannelBrandkitPrimaryLogo","field":"ccChannelBrandkitPrimaryLogo","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"cc-channel-brandkit-primary-logo\"}","merchant_configured":false},{"id":"0199baf9-4be1-712b-aaa9-c74e263e0ae8","handle":"ccChannelBrandkitTitle","field":"ccChannelBrandkitTitle","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"cc-channel-brandkit-title\"}","merchant_configured":false},{"id":"0199baf9-4be1-7d40-9c13-761c885a979a","handle":"ccCollabAffiliateCode","field":"ccCollabAffiliateCode","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"cc-collab-affiliate-code\"}","merchant_configured":false},{"id":"0199baf9-4be1-7209-bcfc-786671acd5a3","handle":"ccCollabAffiliateLink","field":"ccCollabAffiliateLink","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"cc-collab-affiliate-link\"}","merchant_configured":false},{"id":"0199baf9-4be1-70ca-b5f5-30adb6ac0432","handle":"ccCollabDiscountAmount","field":"ccCollabDiscountAmount","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"cc-collab-discount-amount\"}","merchant_configured":false},{"id":"0199baf9-4be1-74bd-8511-4e79b67e9f2e","handle":"ccCollabDiscountCode","field":"ccCollabDiscountCode","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"cc-collab-discount-code\"}","merchant_configured":false},{"id":"0199baf9-4be1-7997-a1d3-0b9bfef187ae","handle":"ccCollabDiscountType","field":"ccCollabDiscountType","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"cc-collab-discount-type\"}","merchant_configured":false},{"id":"0199baf9-4be1-7989-9eb7-48d3733370b6","handle":"ccCreatorCollection","field":"ccCreatorCollection","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"cc-creator-collection\"}","merchant_configured":false},{"id":"0199baf9-4be1-7291-979e-86c6d6575eb9","handle":"ccCreatorDrops","field":"ccCreatorDrops","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"cc-creator-drops\"}","merchant_configured":false},{"id":"0199baf9-4be1-7f58-ad48-b6177cada220","handle":"ccCreatorFirstName","field":"ccCreatorFirstName","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"cc-creator-first-name\"}","merchant_configured":false},{"id":"0199baf9-4be1-7125-988f-c990b140e225","handle":"ccCreatorLastName","field":"ccCreatorLastName","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"cc-creator-last-name\"}","merchant_configured":false},{"id":"0199baf9-4be1-7269-b2bd-43ef48f8393c","handle":"ccCreatorProducts","field":"ccCreatorProducts","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"cc-creator-products\"}","merchant_configured":false},{"id":"0199baf9-4be1-742c-bb77-606447670d22","handle":"ccCreatorProfilePicture","field":"ccCreatorProfilePicture","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"cc-creator-profile-picture\"}","merchant_configured":false},{"id":"0199baf9-4be1-7b21-a127-96976a045115","handle":"ccCreatorShopDescription","field":"ccCreatorShopDescription","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"cc-creator-shop-description\"}","merchant_configured":false},{"id":"0199baf9-4be1-7502-812c-cbc55eb4cf4d","handle":"ccCreatorShopHandle","field":"ccCreatorShopHandle","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"cc-creator-shop-handle\"}","merchant_configured":false},{"id":"0199baf9-4be1-7048-bba7-e2b24d59bfb2","handle":"ccCreatorShopThemePrimaryColor","field":"ccCreatorShopThemePrimaryColor","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"cc-creator-shop-theme-primary-color\"}","merchant_configured":false},{"id":"0199baf9-4be1-760a-a6d6-038c87518683","handle":"ccCreatorShopTitle","field":"ccCreatorShopTitle","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"cc-creator-shop-title\"}","merchant_configured":false},{"id":"0199baf9-4be1-753c-9830-19a85f85092b","handle":"data","field":"data","patched_type":"metaobject_8220180767","arguments":"{\"key\":\"data\"}","merchant_configured":false}],"variables":[],"note":null,"workflow_name":"CC // Update affiliate links when shop handle changes (For handle-based affiliate links)"}}